<template>
  <div class="bg-white shadow rounded px-3 pt-3 pb-5 border border-white">
    <div class="row">
      <div class="col">
        <label for="title" class="block text-sm font-medium text-gray-700"
          >Fyle type</label
        >
        <!-- <add-name class="my-3" @name-added="addNewName" /> -->
        <select
          v-model="form.type"
          name="type"
          class="mt-1 block w-full border-gray p-1"
        >
          <option value="XLSX">XLSX</option>
          <option value="PDF">PDF</option>
        </select>
      </div>
    </div>

    <div class="row mt-4">
      <div class="col">
        <label for="title" class="block text-sm font-medium text-gray-700"
          >Statuses to include in the file</label
        >
        <div>
          <div>
            <input
              class="mt-4"
              label="done"
              type="checkbox"
              v-model="form.pdf"
            /><span class="ml-4 font-medium text-gray-700">Done</span>
            <div></div>
            <input label="todo" type="checkbox" v-model="form.xlsx" /><span
              class="ml-4 font-medium text-gray-700"
              >Todo</span
            >
          </div>
        </div>
      </div>

      <div class="col"></div>
    </div>
    <div class="row mt-4">
      <div class="col text-right">
        <button class="bg-green-400 px-4 py-2 rounded" @click="getFile">
          Download
        </button>
      </div>
    </div>
  </div>
</template>
<script>
import { mapState } from "vuex";
import axios from "axios";

export default {
  data() {
    return {
      apiURL: process.env.VUE_APP_BACKEND_URL,
      form: {
        title: "New Task",
        priority: "MEDIUM",
        color: "GRAY",
        type: "XLSX",
        statuses: "Todo",
      },
    };
  },
  components: {},
  computed: {
    priorityColor() {
      const mappings = {
        HIGH: "red",
        MEDIUM: "yellow",
        LOW: "green",
        default: "teal",
      };

      return mappings[this.form.priority] || mappings.default;
    },
    ...mapState({
      name: (state) => state.name,
      nameAlias: "name",
    }),
  },
  methods: {
    async getFile() {
      await axios({
        url: "api/downloadFile",
        method: "POST",
        data: this.form,
        responseType: "arraybuffer",
      }).then((rs) => {
        this.downloadBinaryFile(rs.data, rs.headers, "Todo");
      });
    },
    downloadFile(content, headers, name) {
      const blob = new Blob([content], { type: headers["content-type"] });
      const link = document.createElement("a");
      link.href = window.URL.createObjectURL(blob);
      link.download = !name
        ? headers["content-disposition"]
            .split("filename=")[1]
            .replace(/(^")|("$)/g, "")
        : name + (blob.type === "application/pdf" ? ".pdf" : "");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    },
    downloadBinaryFile(binaryContent, headers, name) {
      this.downloadFile(new Uint8Array(binaryContent), headers, name);
    },
  },
};
</script>
<style scoped>
.border-gray {
  border-bottom: 1px solid rgba(55, 65, 81, 0.3);
  border-radius: 0;
}
</style>
